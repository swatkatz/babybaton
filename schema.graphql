scalar DateTime

# Enums
enum CareSessionStatus {
  IN_PROGRESS
  COMPLETED
}

enum ActivityType {
  FEED
  DIAPER
  SLEEP
}

enum FeedType {
  BREAST_MILK
  FORMULA
}

enum PredictionConfidence {
  HIGH
  MEDIUM
  LOW
}

# Types
type Family {
  id: ID!
  name: String!
  babyName: String!
  password: String!
  caregivers: [Caregiver!]!
  createdAt: DateTime!
}

type Caregiver {
  id: ID!
  familyId: ID!
  name: String!
  deviceId: String!
  deviceName: String
  createdAt: DateTime!
}

type CareSession {
  id: ID!
  caregiver: Caregiver!
  familyId: ID!
  status: CareSessionStatus!
  startedAt: DateTime!
  completedAt: DateTime
  activities: [Activity!]!
  notes: String
  summary: CareSessionSummary!
}

type CareSessionSummary {
  totalFeeds: Int!
  totalMl: Int!
  totalDiaperChanges: Int!
  totalSleepMinutes: Int!
  lastFeedTime: DateTime
  lastSleepTime: DateTime
  currentlyAsleep: Boolean!
}

union Activity = FeedActivity | DiaperActivity | SleepActivity

type FeedDetails {
  startTime: DateTime!
  endTime: DateTime
  amountMl: Int
  feedType: FeedType
  durationMinutes: Int
}

type DiaperDetails {
  changedAt: DateTime!
  hadPoop: Boolean!
  hadPee: Boolean!
}

type SleepDetails {
  startTime: DateTime!
  endTime: DateTime
  durationMinutes: Int
  isActive: Boolean
}

type FeedActivity {
  id: ID!
  activityType: ActivityType!
  createdAt: DateTime!
  feedDetails: FeedDetails
}

type DiaperActivity {
  id: ID!
  activityType: ActivityType!
  createdAt: DateTime!
  diaperDetails: DiaperDetails
}

type SleepActivity {
  id: ID!
  activityType: ActivityType!
  createdAt: DateTime!
  sleepDetails: SleepDetails
}

type NextFeedPrediction {
  predictedTime: DateTime!
  confidence: PredictionConfidence!
  reasoning: String
  minutesUntilFeed: Int!
}

# Simple wrapper without id/createdAt
type ParsedActivity {
  activityType: ActivityType!
  feedDetails: FeedDetails
  diaperDetails: DiaperDetails
  sleepDetails: SleepDetails
}

type ParsedVoiceResult {
  success: Boolean!
  parsedActivities: [ParsedActivity!]!
  errors: [String!]
  rawText: String!
}

type AuthResult {
  success: Boolean!
  family: Family
  caregiver: Caregiver
  error: String
}

# Inputs
input ActivityInput {
  activityType: ActivityType!
  feedDetails: FeedDetailsInput
  diaperDetails: DiaperDetailsInput
  sleepDetails: SleepDetailsInput
}

input FeedDetailsInput {
  startTime: DateTime!
  endTime: DateTime
  amountMl: Int
  feedType: FeedType
}

input DiaperDetailsInput {
  changedAt: DateTime!
  hadPoop: Boolean!
  hadPee: Boolean
}

input SleepDetailsInput {
  startTime: DateTime!
  endTime: DateTime
}

# Queries
type Query {
  # Family & Auth
  checkFamilyNameAvailable(name: String!): Boolean!
  getMyFamily: Family
  getMyCaregiver: Caregiver

  # Care Sessions (automatically scoped to authenticated caregiver's family)
  getRecentCareSessions(limit: Int): [CareSession!]!
  getCurrentSession: CareSession
  getCareSession(id: ID!): CareSession

  # Predictions
  predictNextFeed: NextFeedPrediction!
}

# Mutations
type Mutation {
  # Family Management
  createFamily(
    familyName: String!
    password: String!
    babyName: String!
    caregiverName: String!
    deviceId: String!
    deviceName: String
  ): AuthResult!

  joinFamily(
    familyName: String!
    password: String!
    caregiverName: String!
    deviceId: String!
    deviceName: String
  ): AuthResult!

  updateBabyName(babyName: String!): Family!

  leaveFamily: Boolean!

  # Care Session Management
  startCareSession: CareSession!

  parseVoiceInput(text: String!): ParsedVoiceResult!

  addActivities(activities: [ActivityInput!]!): CareSession!

  endActivity(activityId: ID!, endTime: DateTime): Activity!

  completeCareSession(notes: String): CareSession!

  deleteActivity(activityId: ID!): Boolean!
}
